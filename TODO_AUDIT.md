# TODO/FIXME Audit

Last updated: 2025-11-10

## Summary

- **Total TODOs in active code**: 23 (Rust + JavaScript)
- **Critical (Blocking features)**: 2
- **High Priority**: 8
- **Medium Priority**: 10
- **Low Priority**: 3

**Note:** Python musicxml-to-lilypond converter TODOs excluded (third-party library)

---

## ðŸ”´ Critical Priority (Blocking Features)

### Undo/Redo System
**Impact:** Core editing feature missing
**Location:** `src/api/core.rs` (8 occurrences)

- `core.rs:941` - Implement efficient undo (batching or incremental)
- `core.rs:1006` - Record undo action (temporarily disabled for performance)
- `core.rs:1091` - Implement efficient undo (batching or incremental)
- `core.rs:1132` - Implement efficient undo
- `core.rs:1181` - Implement efficient undo (batching or incremental)
- `core.rs:1267` - Record undo action (temporarily disabled for performance)
- `core.rs:1315` - Implement efficient undo
- `core.rs:1369` - Implement efficient undo

**Recommendation:** Design and implement undo/redo system in WASM with command pattern.

### Unit Testing
**Impact:** Reduces confidence in position calculations
**Location:** `src/api/position.rs:206`

- Add unit tests after resolving Document/Line struct construction complexity

**Recommendation:** Prioritize after undo/redo implementation.

---

## ðŸŸ¡ High Priority (Degrades User Experience)

### MusicXML Export Features
**Location:** `src/renderers/musicxml/`

1. **Slash notation for grace notes** (`line_to_ir.rs:110, 142`)
   - Wire up slash notation from cell data
   - Impact: Grace note rendering inaccurate

2. **Slur placement** (`line_to_ir.rs:478`)
   - Derive placement from context (currently hardcoded to Above)
   - Impact: Slur positioning may be incorrect

3. **Lyrics verse numbers** (`line_to_ir.rs:507`)
   - Support multiple verse numbers
   - Impact: Multi-verse songs display incorrectly

4. **Clef detection** (`line_to_ir.rs:983`)
   - Derive from line metadata instead of hardcoded "treble"
   - Impact: Bass clef and other clefs not supported

5. **Chord emission** (`emitter.rs:627`)
   - Emit remaining notes with chord=true
   - Impact: Chord notation incomplete

6. **Lyrics parsing** (`export_ir.rs:78`)
   - Parse into Vec<LyricSyllable> during IR construction
   - Impact: Lyrics handling suboptimal

---

## ðŸŸ  Medium Priority (Nice to Have)

### JavaScript Export UI
**Location:** `src/js/export-ui.js`

1. **MusicXML export button** (`export-ui.js:231, 324`)
   - Implement MusicXML export UI
   - Impact: Users can't export MusicXML from UI (only via inspector)

**Recommendation:** Low priority since MusicXML is generated and visible in inspector tab.

### Slur Deletion Protection
**Location:** `src/js/editor.js:1297`

- Move slur deletion protection to WASM
- Impact: Code organization (works but should be in WASM)

**Recommendation:** Refactor during next WASM architecture sprint.

### Ornament Layout System
**Location:** `src/renderers/layout_engine.rs`

1. **Ornament indicator removed** (`layout_engine.rs:158`)
   - Comment noting refactored system
2. **Reimplement ornament layout** (`layout_engine.rs:685`)
   - Use new ornament structure

**Recommendation:** Part of ornament system redesign (may already be addressed).

### WASM Generated Code
**Location:** `src/wasm/editor_wasm.js:203`

- Test for more things (Sets, Maps) in generated code
- Impact: Generated file, not editable manually

**Recommendation:** Ignore (auto-generated by wasm-bindgen).

### Text Replacement Feature
**Location:** `src/api/core.rs:1070`

- Replace selected text instead of just clearing
- Impact: Minor UX improvement

**Recommendation:** Implement when adding advanced text editing features.

---

## âœ… Low Priority (Documentation/Polish)

None currently - all TODOs are actionable code changes.

---

## Recommendations

### Immediate Actions (Next Sprint)
1. **Implement undo/redo system** - Core feature gap
2. **Fix MusicXML clef detection** - Data correctness issue
3. **Add unit tests to position.rs** - Test coverage gap

### Medium Term (Next Quarter)
1. Wire up slash notation for grace notes
2. Support multiple verse numbers in lyrics
3. Derive slur placement from context
4. Complete chord emission in MusicXML

### Low Priority (Backlog)
1. MusicXML export UI button
2. Move slur deletion protection to WASM
3. Replace selected text feature

### Can be Deferred
- Ornament layout system TODOs (may already be addressed)
- WASM generated code improvements (auto-generated file)

---

## Tracking

Create GitHub issues for critical TODOs:
- [ ] Issue #X: Implement undo/redo system (8 occurrences in core.rs)
- [ ] Issue #X: Add unit tests for position calculations
- [ ] Issue #X: Fix MusicXML clef detection
- [ ] Issue #X: Wire up slash notation for grace notes
- [ ] Issue #X: Support multiple verse numbers in lyrics

---

## Notes

- Python converter TODOs (~60 instances) excluded - third-party library
- Archive directory excluded - legacy code
- Generated WASM bindings excluded - not manually editable
